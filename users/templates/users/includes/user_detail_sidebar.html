{% load static %}

{# Stats Cards #}
<div class="card shadow-sm border-0 mb-3">
    <div class="card-header bg-white">
        <h6 class="mb-0"><i class="bi bi-graph-up me-2"></i>Statistiche Mese</h6>
    </div>
    <div class="card-body p-2">
        <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
            <div>
                <small class="text-muted">Timbrature</small>
                <div class="fw-bold">{{ timbrature_mese }}</div>
            </div>
            <i class="bi bi-clock-history text-primary fs-4"></i>
        </div>
        <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
            <div>
                <small class="text-muted">Ore Lavorate</small>
                <div class="fw-bold">{{ ore_mese }}</div>
            </div>
            <i class="bi bi-stopwatch text-success fs-4"></i>
        </div>
        <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
            <div>
                <small class="text-muted">Ferie Residue</small>
                <div class="fw-bold">{{ user_obj.giorni_ferie_residui }}</div>
            </div>
            <i class="bi bi-calendar-check text-info fs-4"></i>
        </div>
        <div class="d-flex justify-content-between align-items-center p-2">
            <div>
                <small class="text-muted">Richieste Pending</small>
                <div class="fw-bold text-warning">{{ ferie_pending|add:permessi_pending }}</div>
            </div>
            <i class="bi bi-hourglass-split text-warning fs-4"></i>
        </div>
    </div>
</div>

{# Foto Profilo #}
<div class="card shadow-sm border-0 mb-3">
    <div class="card-body text-center">
        {% if user_obj.foto_profilo %}
        <img src="{{ user_obj.foto_profilo.url }}" class="user-avatar-xl mb-2 user-avatar-img" alt="{{ user_obj.get_full_name }}">
        {% else %}
        <div class="user-avatar-xl mx-auto mb-2">
            {{ user_obj.get_full_name|default:user_obj.username|slice:":1"|upper }}
        </div>
        {% endif %}
        <h6 class="mb-1">{{ user_obj.get_full_name|default:user_obj.username }}</h6>
        <small class="text-muted">{{ user_obj.codice_dipendente }}</small>
    </div>
</div>

{# Azioni Rapide #}
<div class="card shadow-sm border-0 mb-3">
    <div class="card-header bg-white">
        <h6 class="mb-0"><i class="bi bi-lightning-fill me-2"></i>Azioni Rapide</h6>
    </div>
    <div class="card-body p-2">
        <div class="d-grid gap-2">
            <a href="{% url 'users:timbratura_list' %}" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-clock-history me-2"></i>Timbrature
            </a>
            <a href="{% url 'users:giornata_list' %}" class="btn btn-outline-success btn-sm">
                <i class="bi bi-calendar3 me-2"></i>Giornate
            </a>
            <a href="{% url 'users:richieste_ferie_list' %}" class="btn btn-outline-info btn-sm">
                <i class="bi bi-calendar-check me-2"></i>Ferie
            </a>
            <a href="{% url 'users:richieste_permessi_list' %}" class="btn btn-outline-warning btn-sm">
                <i class="bi bi-clock me-2"></i>Permessi
            </a>
        </div>
    </div>
</div>

{# Gestione Utente (solo per admin/staff) #}
{% if can_manage_user %}
<div class="card shadow-sm border-0">
    <div class="card-header bg-warning text-dark">
        <h6 class="mb-0"><i class="bi bi-gear-fill me-2"></i>Gestione Utente</h6>
    </div>
    <div class="card-body p-2">
        <div class="d-grid gap-2">
            <a href="{% url 'users:user_update' user_obj.pk %}" class="btn btn-warning btn-sm">
                <i class="bi bi-pencil me-2"></i>Modifica Profilo
            </a>
            <a href="{% url 'users:user_permissions_manage' user_obj.pk %}" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-shield-lock me-2"></i>Gestisci Permessi
            </a>
            <a href="{% url 'users:lettera_richiamo_create' %}?dipendente={{ user_obj.pk }}" class="btn btn-outline-danger btn-sm">
                <i class="bi bi-envelope-exclamation me-2"></i>Lettera Richiamo
            </a>
        </div>
    </div>
</div>
{% endif %}
